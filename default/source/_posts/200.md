---
title: 用CloudStudio安装AMH 5.5 面板 架设网站
tags:
  - typecho
  - CloudStudio
  - Coding
  - AMH
url: NaN.html
id: .nan
categories:
  - 前端
date: 2018-08-06 22:29:00
---

从搬瓦工的VPS把博客搬到CloudStudio，踩坑预警

已经炸完了，不知道还能不能用

Cloud Studio 配置
---------------

### 传送门

[https://studio.coding.net](https://studio.coding.net)

### 等待配置

开启一月试用，需绑定腾讯云账号，根据提示操作即可。首次打开的时间可能会很长，如果很久仍然在加载请刷新。

### 选择环境

加载完毕以后选择环境，因为要安装`AMH面板`所以选择`Ubuntu 16.04 已安装 Python 2.7.12，Python 3.5.2`这个环境  
选择新环境，切换，等待配置完成。

### 配置环境

在左下方打开终端，一般是默认开启的，输入以下几条命令

    sudo apt-get update
    #更新源
    sudo passwd root
    #更改root密码
    su root
    #使用root用户

AMH 5.5 安装
----------

注意：AMH 5.5 为付费版本，AMH4.2免费版本安装失败，具体原因没找出来

### 修改DNS

来自amh.sh的命令：

    echo -e "options timeout:1 attempts:1 rotate\nnameserver 8.8.8.8\nnameserver 114.114.114.114" >/etc/resolv.conf;

### 安装极速安装包

    wget http://amh.sh/amh.sh && bash amh.sh 2>&1 | tee amh.log

运行后选择`4`，不能选`1）中国[CN]`，会超时，中间可能会有各种提示，通通`y`+`回车`同意。正常来说应该不会出现这种情况，记不清了，之前安装过AMH4.2，但是并不能安装成功，总是报错。  
成功安装后系统会提示AMH与MySQL默认账号密码。  
可使用普通连接访问面板，[http://ip](http://ip):8888  
或加密的连接访问面板，[https://ip](https://ip):9999  
ip在这里可以看到：[https://console.cloud.tencent.com/lighthosting](https://console.cloud.tencent.com/lighthosting)

AMH 5.5 配置
----------

没用过5.5的面板，刚下下来的时候一脸懵逼，现在折腾了一下算是看懂了，首先需要下载插件

### 下载插件

版本根据要求自行选择  
需要的插件有：

*   LNMP环境（环境搭建，必备）
*   phpmyadmin（数据库管理，必备）
*   amfile（在线编辑文件，选配）
*   ampathinfo（Typecho必备，被坑过，不然可能会出现后台404）
*   amcrontab（任务计划，备份必备）
*   amdata（备份插件，备份必备）
*   amqcloud（远程备份插件，备份到腾讯COS，备份必备）

### 配置/搭建网站

1.  在插件`LNMP 环境管理`里`创建环境`,填写相关信息，监听端口默认`80`，Rewrite规则应该只有amh.conf,先默认
2.  在插件`phpmyadmin`里新建数据库，选择`utf8_general_ci`编码,添加用户及权限
3.  在`CloudStudio`里面右上角有绑定域名，输入域名，端口为`80`
4.  在域名提供商解析域名到[服务器ip](https://console.cloud.tencent.com/lighthosting)
5.  访问域名即可开始搭建网站

搭建Typecho网站遇到的坑
---------------

### CloudStudio申请SSL证书一直排队

在腾讯云直接申请SSl然后在CloudStudio绑定即可识别为https访问

### 访问后台404

开启pathinfo，AMH5.5面板有插件

### 伪静态无法启用

在AMH面板中选择typecho.conf  
下面附一份规则，放置在`/home/wwwroot/新建的环境名称/rewrite/`目录下保存为typecho.conf即可，nginx可修改配置文件修改重写规则

    location / {
        index index.html index.php;
        if (-f $request_filename/index.html){
            rewrite (.*) $1/index.html break;
        }
        if (-f $request_filename/index.php){
            rewrite (.*) $1/index.php;
        }
        if (!-f $request_filename){
            rewrite (.*) /index.php;
        }
    }

### typecho无法导入自带备份导出的备份文件

手动搬迁，下载所有文件，在phpmyadmin中导出数据库。  
然后在新空间上传所有文件，在phpmyadmin导入数据库。